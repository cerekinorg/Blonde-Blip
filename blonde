#!/usr/bin/env python3
"""
Blonde CLI v2.0 Launcher
Clean, working launcher using new simplified systems
"""

import sys
from pathlib import Path
import json

# Add project root to path
PROJECT_ROOT = Path(__file__).parent
sys.path.insert(0, str(PROJECT_ROOT))

CONFIG_DIR = Path.home() / ".blonde"
CONFIG_FILE = CONFIG_DIR / "config.json"


def main():
    """
    Main entry point using new simplified systems
    """
    print("üé® Welcome to Blonde CLI v2.0!")
    print("Privacy-First Multi-Agent AI Development Platform\n")

    # Ensure config directory exists
    CONFIG_DIR.mkdir(parents=True, exist_ok=True)

    # Check if setup needed
    if not CONFIG_FILE.exists():
        print("Running setup...\n")

        try:
            # Import new core systems
            from tui.core import get_config_manager

            # Create default config
            default_config = {
                'provider': 'openrouter',
                'model': 'openai/gpt-4',
                'blip_character': 'axolotl',
                'setup_complete': True
            }

            CONFIG_FILE.parent.mkdir(parents=True, exist_ok=True)
            with open(CONFIG_FILE, 'w') as f:
                json.dump(default_config, f, indent=2)

            print("‚úÖ Setup complete!\n")

        except Exception as e:
            print(f"‚ùå Setup error: {e}")
            sys.exit(1)

    # Launch TUI
    try:
        # Import from tui module
        from tui.simple_dashboard import SimpleDashboard

        print("üöÄ Launching Blonde CLI v2.0...\n")

        # Run dashboard
        app = SimpleDashboard()
        app.run()

    except KeyboardInterrupt:
        print("\nüëã Goodbye!")
        sys.exit(0)
    except ModuleNotFoundError as e:
        print(f"\n‚ùå Import error: {e}")
        print("\nPlease ensure all dependencies are installed:")
        print("  pip install -r requirements.txt\n")
        print("Or check the file structure:\n")
        print(f"  Project root: {PROJECT_ROOT}")
        print("  Available files:")
        import os
        for item in os.listdir(PROJECT_ROOT / "tui"):
            if item.startswith("simple") and item.endswith(".py"):
                print(f"    - tui/{item}")
        sys.exit(1)
    except Exception as e:
        print(f"\n‚ùå Error: {e}")
        import traceback
        traceback.print_exc()
        sys.exit(1)


if __name__ == "__main__":
    main()
